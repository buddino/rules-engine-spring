package it.unifi.dinfo.rulesengine.rules;

import it.unifi.dinfo.rulesengine.configuration.ContextProvider;
import it.unifi.dinfo.rulesengine.service.SwaggerClient;
import org.easyrules.annotation.Action;
import org.easyrules.annotation.Condition;
import org.easyrules.annotation.Rule;
import org.mapdb.DB;
import org.mapdb.HTreeMap;
import org.mapdb.Serializer;
import org.springframework.beans.factory.annotation.Autowired;

@Rule
public class ExploitNaturalLight {

    Long exceedings = 0L;
    Long exceedingsThreshold = 3L;

    DB embeddedDB;

    public ExploitNaturalLight(){
        embeddedDB = (DB) ContextProvider.getBean("embeddedDB");
    }

    @Condition
    public boolean condition() {
        HTreeMap<String, Long>  exceedingsMap = embeddedDB.hashMap("exeedings", Serializer.STRING, Serializer.LONG).open();
        Long exceedings = exceedingsMap.get("gaia-prato/gw1/weather/light");
        return exceedings > exceedingsThreshold;
    }

    @Action
    public void action() {
        System.err.println(String.format("Exceedings (%d) greater than threshold (%d)", exceedings, exceedingsThreshold));
    }
}
